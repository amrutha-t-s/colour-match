<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ColorMatch Boutique - PERFECT Spacing</title>
    <meta
      name="description"
      content="AI Skin Detection + Easy Outfit Builder"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <style>
      /* PERFECT SPACING STYLES */
      .outfit-builder {
        grid-column: 1 / -1;
        text-align: center;
        padding: 3rem;
      }
      .outfit-canvas {
        margin: 2rem 0;
      }
      .outfit-canvas h4 {
        color: #5a6c7d;
        margin-bottom: 1.5rem;
        font-size: 1.4rem;
      }
      #outfitCanvas {
        border: 4px solid rgba(255, 255, 255, 0.6);
        border-radius: 20px;
        box-shadow: 0 25px 60px rgba(0, 0, 0, 0.3);
        display: block;
        margin: 0 auto;
      }
      .select-section {
        display: flex;
        gap: 2.5rem;
        justify-content: center;
        flex-wrap: wrap;
        margin: 3rem 0;
      }
      .select-group {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1.2rem;
        background: rgba(255, 255, 255, 0.25);
        padding: 2.2rem;
        border-radius: 25px;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
      }
      .select-group label {
        font-weight: 700;
        font-size: 1.4rem;
        color: #2c3e50;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .color-options {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        padding: 1.5rem;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 18px;
        min-height: 130px;
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.4);
      }
      .color-btn {
        width: 52px;
        height: 52px;
        border-radius: 14px;
        border: 4px solid rgba(255, 255, 255, 0.9);
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      }
      .color-btn:hover {
        transform: scale(1.25) rotate(8deg);
        border-color: white;
        box-shadow: 0 12px 35px rgba(0, 0, 0, 0.4);
      }
      .color-btn.selected {
        border-color: #ff6b6b;
        border-width: 6px;
        transform: scale(1.35);
        box-shadow:
          0 0 35px #ff6b6b,
          0 0 60px rgba(255, 107, 107, 0.6);
        animation: bounce 0.6s ease;
      }
      @keyframes bounce {
        0%,
        100% {
          transform: scale(1.35);
        }
        50% {
          transform: scale(1.45);
        }
      }
      #outfitPreview {
        margin-top: 2.5rem;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.35);
        border-radius: 20px;
        font-size: 1.2rem;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>üõçÔ∏è ColorMatch Boutique</h1>
      <p>AI Skin Analysis + Perfect Outfit Builder</p>
    </header>

    <main class="home-grid">
      <!-- CAMERA SKIN DETECTION -->
      <div class="camera-section">
        <h2>üì∏ Detect My Skin Tone</h2>
        <p style="color: #5a6c7d; margin-bottom: 1.5rem">
          Hold camera 30cm from face
        </p>
        <video
          id="video"
          autoplay
          playsinline
          muted
          width="100%"
          height="260"
          style="
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
          "
        ></video>
        <canvas id="canvas" style="display: none"></canvas>
        <br />
        <button id="detect-skin" class="detect-btn">üîç Analyze My Skin</button>
        <div id="skin-result" class="result" style="margin-top: 2rem"></div>
      </div>

      <!-- üî• MAIN OUTFIT BUILDER - PERFECT SPACING -->
      <div class="outfit-builder">
        <h2>üëó Create Perfect Outfit</h2>

        <!-- Live Preview Canvas -->
        <div class="outfit-canvas">
          <h4>‚ú® Live Preview</h4>
          <canvas id="outfitCanvas" width="480" height="580"></canvas>
        </div>

        <!-- COLOR SELECTORS -->
        <div class="select-section">
          <div class="select-group">
            <label>üëï Shirt Color</label>
            <div class="color-options" id="shirtColors"></div>
          </div>

          <div class="select-group">
            <label>üëñ Pants Color</label>
            <div class="color-options" id="pantsColors"></div>
          </div>

          <div class="select-group">
            <label>üëú Bag Color</label>
            <div class="color-options" id="bagColors"></div>
          </div>
        </div>

        <button
          id="saveOutfit"
          class="detect-btn"
          style="font-size: 1.3rem; padding: 1.5rem 4rem; margin: 2rem 0"
        >
          üíæ Save My Perfect Outfit
        </button>

        <div id="outfitPreview">
          <strong>‚ú® Current Outfit:</strong>
          <span id="previewText">Click colors above to start styling!</span>
        </div>
      </div>

      <!-- SKIN TYPE SHORTCUTS -->
      <a href="dusky.html" class="skin-card dusky-card">
        <h2>üåü Dusky Skin</h2>
        <p>Rich jewel tones</p>
      </a>
      <a href="warm.html" class="skin-card warm-card">
        <h2>üåû Warm Skin</h2>
        <p>Peach & coral</p>
      </a>
      <a href="cool.html" class="skin-card cool-card">
        <h2>‚ùÑÔ∏è Cool Skin</h2>
        <p>Blue & silver</p>
      </a>
      <a href="light.html" class="skin-card light-card">
        <h2>‚ú® Light Skin</h2>
        <p>Soft pastels</p>
      </a>
    </main>

    <div style="text-align: center; padding: 3rem">
      <a href="saved.html" class="view-saved-btn" id="saved-count-btn">
        üíé View Saved Outfits <span id="saved-count">(0)</span>
      </a>
    </div>

    <footer>
      <p>¬© 2026 ColorMatch Boutique | VTU Makeathon Winner üèÜ</p>
    </footer>

    <script>
      // üî• 16 PERFECT COLORS
      const COLORS = [
        { name: "Coral", hex: "#FF7F50" },
        { name: "Peach", hex: "#FFDAB9" },
        { name: "Gold", hex: "#B8860B" },
        { name: "Emerald", hex: "#50C878" },
        { name: "Deep Red", hex: "#8B0000" },
        { name: "Burgundy", hex: "#800020" },
        { name: "Mustard", hex: "#FFDB58" },
        { name: "Terracotta", hex: "#E2725B" },
        { name: "Baby Blue", hex: "#89CFF0" },
        { name: "Silver", hex: "#C0C0C0" },
        { name: "Lavender", hex: "#E6E6FA" },
        { name: "Teal", hex: "#008080" },
        { name: "Blush Pink", hex: "#FFC0CB" },
        { name: "Beige", hex: "#F5F5DC" },
        { name: "Ivory", hex: "#FFFFF0" },
        { name: "Sky Blue", hex: "#87CEEB" },
      ];

      // üî• SKIN DETECTOR
      class SkinDetector {
        constructor() {
          this.video = document.getElementById("video");
          this.canvas = document.getElementById("canvas");
          this.ctx = this.canvas.getContext("2d");
          document.getElementById("detect-skin").onclick = () => this.analyze();
          this.initCamera();
        }

        async initCamera() {
          try {
            this.video.srcObject = await navigator.mediaDevices.getUserMedia({
              video: { facingMode: "user", width: 320, height: 240 },
            });
          } catch (e) {
            document.getElementById("skin-result").innerHTML =
              "üì± <strong>Enable Camera</strong> for AI skin analysis";
          }
        }

        analyze() {
          this.ctx.drawImage(this.video, 0, 0, 320, 240);
          const data = this.ctx.getImageData(0, 0, 320, 240).data;
          let r = 0,
            g = 0,
            b = 0,
            pixels = 0;
          for (let i = 0; i < data.length; i += 12) {
            r = data[i];
            g = data[i + 1];
            b = data[i + 2];
            if (r > 50 && g > 30 && b < 180 && r > g) {
              pixels++;
              r += 10;
              g += 5;
            }
          }
          const avgR = r / pixels,
            avgG = g / pixels,
            avgB = b / pixels;
          const type =
            (avgR + avgG + avgB) / 3 > 180
              ? "light"
              : avgR > avgB + 30
                ? "warm"
                : "cool";

          document.getElementById("skin-result").innerHTML =
            `üéâ <strong>${type.charAt(0).toUpperCase() + type.slice(1)} Skin Detected!</strong>`;
          document.getElementById("skin-result").className = `result ${type}`;
        }
      }

      // üî• PERFECT OUTFIT BUILDER - ZERO OVERLAP!
      class OutfitBuilder {
        constructor() {
          this.canvas = document.getElementById("outfitCanvas");
          this.ctx = this.canvas.getContext("2d");
          this.outfit = { shirt: null, pants: null, bag: null };
          this.init();
        }

        init() {
          this.createColorPickers();
          this.draw(); // Initial draw
          document.getElementById("saveOutfit").onclick = () => this.save();
        }

        createColorPickers() {
          const parts = ["shirt", "pants", "bag"];
          parts.forEach((part) => {
            const container = document.getElementById(`${part}Colors`);
            container.innerHTML = COLORS.map(
              (color) =>
                `<div class="color-btn" style="background:${color.hex}" 
                   data-part="${part}" data-color="${color.hex}" 
                   title="${color.name}"></div>`,
            ).join("");
          });

          document.addEventListener("click", (e) => {
            if (e.target.classList.contains("color-btn")) {
              const part = e.target.dataset.part;
              const color = e.target.dataset.color;

              document
                .querySelectorAll(`[data-part="${part}"]`)
                .forEach((btn) => {
                  btn.classList.remove("selected");
                });

              e.target.classList.add("selected");
              this.outfit[part] = color;
              this.draw();
              this.updatePreview();
            }
          });
        }

        // üî• PERFECTLY SPACED DRAW METHOD
        draw() {
          this.ctx.clearRect(0, 0, 480, 580);

          // 1. SKIN SILHOUETTE
          this.ctx.fillStyle = "#D2B48C";
          this.ctx.fillRect(130, 80, 220, 480);

          // 2. SHIRT AREA (Y=190 to 270 = 80px height)
          if (this.outfit.shirt) {
            this.ctx.fillStyle = this.outfit.shirt;
            this.ctx.fillRect(150, 190, 180, 80);
          }

          // 3. PANTS AREA (Y=350 to 430 = 80px height)
          if (this.outfit.pants) {
            this.ctx.fillStyle = this.outfit.pants;
            this.ctx.fillRect(150, 350, 180, 80);
          }

          // 4. BAG CIRCLE (Y=500 center)
          if (this.outfit.bag) {
            this.ctx.fillStyle = this.outfit.bag;
            this.ctx.beginPath();
            this.ctx.arc(240, 500, 30, 0, Math.PI * 2);
            this.ctx.fill();
          }

          // 5. WHITE OUTLINES
          this.ctx.strokeStyle = "rgba(255,255,255,0.9)";
          this.ctx.lineWidth = 3;
          this.ctx.strokeRect(150, 190, 180, 80); // Shirt
          this.ctx.strokeRect(150, 350, 180, 80); // Pants
          this.ctx.beginPath();
          this.ctx.arc(240, 500, 30, 0, Math.PI * 2);
          this.ctx.stroke(); // Bag

          // 6. PERFECT LABELS (NO OVERLAP!)
          this.ctx.fillStyle = "rgba(255,255,255,0.98)";
          this.ctx.strokeStyle = "rgba(180,180,180,0.8)";
          this.ctx.lineWidth = 1.8;
          this.ctx.font = "bold 17px Poppins";
          this.ctx.textAlign = "center";

          // Shirt label (Y=135-155 = ABOVE shirt Y=190)
          this.ctx.fillRect(240, 135, 80, 24);
          this.ctx.strokeRect(240, 135, 80, 24);
          this.ctx.fillStyle = "#2c3e50";
          this.ctx.fillText("üëï Shirt", 240, 152);

          // Pants label (Y=300-320 = GAP between shirt/pants)
          this.ctx.fillRect(240, 300, 80, 24);
          this.ctx.strokeRect(240, 300, 80, 24);
          this.ctx.fillStyle = "#2c3e50";
          this.ctx.fillText("üëñ Pants", 240, 317);

          // Bag label (Y=540-560 = BELOW bag Y=500)
          this.ctx.fillRect(240, 540, 80, 24);
          this.ctx.strokeRect(240, 540, 80, 24);
          this.ctx.fillStyle = "#2c3e50";
          this.ctx.fillText("üëú Bag", 240, 557);

          this.ctx.textAlign = "left";
        }

        updatePreview() {
          const parts = ["shirt", "pants", "bag"];
          let selected = parts
            .filter((p) => this.outfit[p])
            .map((p) => {
              const color = COLORS.find((c) => c.hex === this.outfit[p]);
              return color ? color.name : "None";
            });

          document.getElementById("previewText").textContent =
            selected.join(" + ") || "Click colors above to start styling!";
        }

        save() {
          const outfits = JSON.parse(
            localStorage.getItem("savedOutfits") || "[]",
          );
          outfits.push({
            ...this.outfit,
            date: new Date().toISOString(),
            preview: Object.values(this.outfit).filter(Boolean),
          });
          localStorage.setItem("savedOutfits", JSON.stringify(outfits));

          const toast = document.createElement("div");
          toast.style.cssText = `
            position: fixed; top: 20px; right: 20px; 
            background: linear-gradient(45deg, #10b981, #059669);
            color: white; padding: 1.5rem 2.5rem; border-radius: 30px; 
            font-weight: 700; font-size: 1.1rem;
            box-shadow: 0 20px 50px rgba(16,185,129,0.4); z-index: 10000;
            animation: slideIn 0.5s ease;
          `;
          toast.innerHTML = "üéâ OUTFIT SAVED PERFECTLY!";
          document.body.appendChild(toast);
          setTimeout(() => toast.remove(), 3500);
        }
      }

      // START EVERYTHING
      document.addEventListener("DOMContentLoaded", () => {
        new SkinDetector();
        new OutfitBuilder();

        const saved = JSON.parse(localStorage.getItem("savedColors") || "[]");
        document.getElementById("saved-count").textContent =
          `(${saved.length})`;
      });
    </script>
  </body>
</html>
